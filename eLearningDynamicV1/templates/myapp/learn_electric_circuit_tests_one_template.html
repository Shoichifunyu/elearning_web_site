<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FunyuSpace!!</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css" integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
    <link href="design.css" rel="stylesheet" type="text/css">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <nav class="navbar navbar-expand-md navbar-light bg-light">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="sidebarMenu">
            <ul class="navbar-nav flex-column">
              <li class="nav-item">
                <a class="nav-link" href="./learn_electric_circuit.html">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                  <span class="ml-2">目次</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./learn_electric_circuit_contents_one.html">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                  <span class="ml-2">学習①</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./learn_electric_circuit_tests_one.html">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                  <span class="ml-2">テスト①</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./learn_electric_circuit_contents_two.html">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                  <span class="ml-2">学習②</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./learn_electric_circuit_tests_two.html">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                  <span class="ml-2">テスト②</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./construction_view.html">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                  <span class="ml-2">学習③</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./construction_view.html">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                  <span class="ml-2">テスト③</span>
                </a>
              </li>
            </ul>
          </div>
        </nav>
        </div>
        <div class="col-md-9">
            <h2>テスト</h2>
            <p>それではテストです。</p>

            <div class="container">
              <div class="countdown">
                <h6 class="countdown-title">制限時間
                  <span id="year" class="new-year"></span>
                </h6>
                <div class="time-container">
                  <p class="time"><span id="minutes" class="time-num">01</span>minutes</p>
                  <p class="time"><span id="seconds" class="time-num">00</span>seconds</p>
                </div>
              </div>
            </div>
            <!-- ボタンコントロール部分 -->
            <div id="controls">
              <div class="box">
                <button id="start">スタート</button>
              </div>
            </div>
            {% set lists = ["1", "1", "1", "1", "1"] %}
            {% for i in lists %}
            <h4>テスト{{loop.index}}</h4>
            <p>|q{{loop.index}}|</p>
            <select id="select0{{loop.index}}">
              <option value="value01">|sa{{ loop.index }}|</option>
              <option value="value02">|sb{{ loop.index }}|</option>
              <option value="value03">|sc{{ loop.index }}|</option>
              <option value="value04">|sd{{ loop.index }}|</option>
            </select>

            <button id="select_btn{{ loop.index }}" type="button" class="btn btn-primary" data-modal-title="modal-{{ loop.index }}">
              回答
            </button><br>

            <!-- モーダルウィンドウを起動するボタン -->
            <label class="ECM_CheckboxInput"><input class="ECM_CheckboxInput-Input" type="checkbox" id="checkElement{{ loop.index }}" disabled="disabled"><span class="ECM_CheckboxInput-DummyInput"></span><span class="ECM_CheckboxInput-LabelText"></span>正答</label>
            
            <div class="modal fade" id="exampleModal{{loop.index}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel{{loop.index}}">Modal title</h5>
                  </div>
                  <div class="modal-body" id="exampleModalBody{{loop.index}}">
                    ...
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
            <div class="modal fade" id="exampleModalCntDwn" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabelCntDwn">Modal title</h5>
                  </div>
                  <div class="modal-body" id="exampleModalBodyCntDwn">
                    ...
                  </div>
                </div>
              </div>
            </div>
        </div>
    </div>
  </div>
  
  <script>
  let myModalCntDwn = new bootstrap.Modal(document.getElementById('exampleModalCntDwn'), {})
  let btnCntDwn = document.getElementById("select_btn_cnt_dwn")
  let elementCntDwn = document.getElementById("selectCntDwn")
  let modalTitleCntDwn = document.getElementById('exampleModalLabelCntDwn')
  let modalBodyCntDwn = document.getElementById('exampleModalBodyCntDwn')
  let selectedValueCntDwn = $('#selectCntDwn option:selected').text();
  // 要調整
  let totalScore = 5;
  let scoreCnt = 0;

  //即時関数
  (function () {
  let timer = document.getElementById('timer');
  let start = document.getElementById('start');

  // スタートタイムを押した時の時間を入れる変数
  let startTime;
  let diff = 0;

  // 残り時間を計算するための変数
  let timeLeft;

  // 現在時刻と表示形式を合わせるために * 1000
  let timeToCountDown = 60000;

  // clearTimeoutメソッドを使いたいので、その時用に変数定義
  let timerId;

  // カウントダウンの状態を管理できるようにする
  let isRunning = false;

  // 要素を取得
  const minutes = document.getElementById('minutes');
  const seconds = document.getElementById('seconds');

  // 残り時間を表示するために、ミリ秒を渡すと、分や秒に直してくれる関数
  function updateTimer(t) {

    // 引数として渡されたtでデータオブジェクトを作りたいので変数dという変数名で作ってみる
    let d = new Date(t);
    let m = d.getMinutes();
    let s = d.getSeconds();

    // 取得した時間をDOMに追加
    minutes.innerText = m < 10 ? '0' + m : m;
    seconds.innerText = s < 10 ? '0' + s : s;
  }


  function countDown() {

    // 10ミリ秒後に実行する
    timerId = setTimeout(function () {

        // 残り時間 = カウントされる時間 - 現在時刻
        timeLeft = timeToCountDown - (Date.now() - startTime);

        // 残り時間が0になった時の処理
        if (timeLeft < 0) {
            isRunning = false;
            start.textContent = 'スタート';
            clearTimeout(timerId);
            timeLeft = 0;

            timeToCountDown = 0;

            modalTitleCntDwn.textContent = "時間切れ"
            modalBodyCntDwn.textContent = `全${totalScore}問中${scoreCnt}問正解！`
            myModalCntDwn.show()
            updateTimer(timeLeft);

            return;
        }

        // countDownを再帰的に呼び出すために記述
        updateTimer(timeLeft)
        countDown();

    }, 10);
  }

  // スタートを押したときの処理
  start.addEventListener('click', function () {

  if (isRunning === false) {
      isRunning = true;

      start.textContent = 'ストップ';
      
      startTime = Date.now();

      // カウントダウンの機能は再帰的に実行
      countDown();
  } else {
      isRunning = false;

      // 表記をStartに戻す
      start.textContent = 'スタート';

      // この時点のtimeLeftで更新してあげる
      timeToCountDown = timeLeft;

      // カウントを止めたいのでclearTimeoutする
      clearTimeout(timerId);
  }
  });
})();
  {% for i in lists %}
    let myModal{{ loop.index }} = new bootstrap.Modal(document.getElementById('exampleModal{{loop.index}}'), {})
    let btn{{ loop.index }} = document.getElementById("select_btn{{ loop.index }}")
    let element{{ loop.index }} = document.getElementById("select0{{ loop.index }}")
    let modalTitle{{ loop.index }} = document.getElementById('exampleModalLabel{{loop.index}}')
    let modalBody{{ loop.index }} = document.getElementById('exampleModalBody{{loop.index}}')
    let selectedValue{{ loop.index }} = $('#select0{{ loop.index }} option:selected').text();
  {% endfor %}
  {% for i in lists %}
    $('#select0{{ loop.index }}').change(function() {
      console.log("changed value" + $('#select0{{ loop.index }} option:selected').text())
      selectedValue{{ loop.index }} = $('#select0{{ loop.index }} option:selected').text();
    })
    btn{{ loop.index }}.addEventListener('click', (e) => {
      if (selectedValue{{ loop.index }} === "|a{{loop.index}}|") {
        modalTitle{{ loop.index }}.textContent = "正解！"
        modalBody{{ loop.index }}.textContent = "|a_des{{loop.index}}|"
        checkElement{{ loop.index }}.disabled = false;
        checkElement{{ loop.index }}.checked = true;
        checkElement{{ loop.index }}.disabled = true;
        scoreCnt += 1;
      } else {
        modalTitle{{ loop.index }}.textContent = "不正解！"
        modalBody{{ loop.index }}.textContent = ""
        checkElement{{ loop.index }}.disabled = false;
        checkElement{{ loop.index }}.checked = false;
        checkElement{{ loop.index }}.disabled = true;
        scoreCnt -= 1;
      }
      myModal{{ loop.index }}.show()
    })
  {% endfor %}
  </script>
</body>
